# Author - Siddharth Nadgaundi
# Date & Version - March 2022, V1

import mysql.connector as abcd
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sqlalchemy import create_engine
print("*****Car Parking System*****")
#creating database
mydb=abcd.connect(host="localhost",user="root",passwd="oakridge")
mycursor=mydb.cursor()
mycursor.execute("create database if not exists parking")
mycursor.execute("use parking")
#creating table
mycursor.execute("create table if not exists car(parking_spot int(1) primary key,\
car_type varchar(9) NOT NULL,num_days int(2) NOT NULL,price int(4) NOT NULL)")
mydb.commit()
while (True):
    print("1=Park Car")
    print("2=Remove Car")
    print("3=Car Type Details")
    print("4=Data Analysis")
    ch=int(input("Enter your choice:"))
    if(ch==1):
        print("*****There are 10 parking spots in total*****")
        print("Please enter the parking details:")
        parking_spot=input("Enter the parking spot (1 to 10):")
        car_type=input("Enter the car type (SUV,SEDAN,HATCHBACK):")
        num_days=input("Enter the number of days you want to park (1 to 10):")
        price= str(100*int(num_days))
        if(int(parking_spot) < 1 or int(parking_spot) > 10):
            print("Error-Please enter parking spot between 1 and 10")
        elif(int(num_days) < 1 or int(num_days) > 10):
            print("Error-Please enter number of days between 1 and 10")
        else:
            mycursor.execute("select parking_spot from car where parking_spot ='"+parking_spot+"'")
            abc=mycursor.fetchall()
            cnt=mycursor.rowcount
        if cnt>0:
            print("Error-Parking spot is already used. Please enter another parking spot value.")
        else:
            mycursor.execute("insert into car values('"+parking_spot+"','"+car_type+"','"+num_days+"','"+price+"')")
            mydb.commit()
            print("Car has been parked")
    elif(ch==2):
        print("Please enter details of the car you want to remove:")
        parking_spot=input("Enter the parking spot:")
        mycursor.execute("delete from car where parking_spot='"+parking_spot+"'")
        mydb.commit()
        print("Car has been removed")
    elif(ch==3):
        mycon=abcd.connect(host="localhost",user="root",passwd="oakridge",database="parking")
        if mycon.is_connected():
            print("Please enter the car type:")
            car_type=input("Enter the car type:")
            query="select * from car where car_type='"+car_type+"';"
            data=pd.read_sql(query,mycon)
            print(data)
        else:
            print("Can't connect")
            mycon.close()
    elif(ch==4):
        mycursor.execute("select parking_spot,num_days from car")
        table_rows=mycursor.fetchall()
        data2=pd.DataFrame(table_rows,columns=["parking_spot","num_days"])
        PARKING_SPOT=data2['parking_spot'].values.tolist()
        NUM_DAYS=data2['num_days'].values.tolist()
        plt.figure(figsize=(10,7))
        plt.plot(PARKING_SPOT,NUM_DAYS,"co",markersize=5,ls="solid",markeredgecolor="k")
        plt.xticks(np.arange(1,11,1))
        plt.yticks(np.arange(1,11,1))
        plt.xlim([1,11])
        plt.ylim([1,11])
        plt.xlabel("Parking Spot")
        plt.ylabel("Number of Days")
        plt.title("Number of Days each Parking Spot is Used")
        plt.show()
    else:
        break
                
